<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mouvement eliptique soleil-terre</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body style="background-color: black; height: 100%; width: 100%; margin: 0; padding: 0;">


      <div id="infobox" style="float: right; margin: 50pt; color: white;"></div>

      <div id="star" style="height: 120px; width: 120px; border-radius: 50%; background-color: #3275ef; position: absolute;"></div>

      <div id="sat" style="height: 200px; width: 50px; background-image: url('satelite.png'); background-size: 100%; background-repeat: no-repeat; position: absolute;"></div>



      <script type="text/javascript">

        let star = document.getElementById("star");
        let sat = document.getElementById("sat");


        // positions initiales
        star.style.top = (window.innerHeight/2)-(120/2)+"px"; star.style.left = (window.innerWidth/2)-(120/2)+"px";
        sat.style.top = (window.innerHeight/2)-(200/2)+"px"; sat.style.left = (window.innerWidth/2)-(50/2)+"px";


        function degtorad(deg){
            if (deg > 360) deg = 0
            return deg * Math.PI/180
        }



        const PIXEL = 0.3

        const GRAVITY_UNIVERSAL = 6.67430 * 10**(-11) // force
        const SAT_MASSE = 150 // kg Artificial Satelite
        const ASTRE_MASS = 5.972 * 10**24 // kg | Earth

        const RAYON_TERRE = 6371*10**3 //m

        const DISTANCE_SATELITE_min = 250 * 10 **3 + RAYON_TERRE//m
        const DISTANCE_SATELITE_max = 300 * 10 **3 + RAYON_TERRE//m
        
        let OB = DISTANCE_SATELITE_min
        let OA = DISTANCE_SATELITE_max
        
        let SB = OA

        let T = 2 * Math.PI * Math.sqrt( SB**3 / (GRAVITY_UNIVERSAL * ASTRE_MASS) )


        let time = 0.0;

        let Fusat = 1

        function timeLoop(){

          let realTime = Date.now() / 1000

          time = realTime // multiplié par 60 secondes


          let SO = Math.sqrt( SB**2 - OB**2 ) // a**2 = b**2 + c**2 => c = sqrt(a**2 - b**2) 


          let e = SO/SB // excentricité (applatissement de l'elipse)

          let angle_OAP = (2*Math.PI/T) * time


          let angle_BSO = Math.sin( OB * Math.sin(90) / SB )

          let mouvement_moyen = 2*Math.PI/T

          let anomalie_moyenne = mouvement_moyen * (time - 0)


          let AS = OA - SO;

          let SP = SB * ( 1 - e * Math.cos(angle_OAP) )

          let SH = SB * ( Math.cos(angle_OAP - e) )
          let HP = SB * Math.sqrt( 1 - e**2 ) * Math.sin(angle_OAP)

          let OH = SO - SH

          let OP = HP / Math.sin(angle_OAP)
          
          let R = OP;

          let v_eloignement = Math.sqrt(1/SB)

          let v_periphelie = Math.sqrt( (GRAVITY_UNIVERSAL * ASTRE_MASS / SB ) * ( 1+e ) / ( 1-e ) )
          let v_aphelie = Math.sqrt( (GRAVITY_UNIVERSAL*ASTRE_MASS/SB) * (1-e) / (1+e) )

          let d_periphelie = SB * ( 1 - e)
          let d_aphelie = SB * (1+e)


          //coordonées          
          let x = OH * PIXEL * v_eloignement
          let y = HP * PIXEL * v_eloignement

          sat.style.setProperty("left", `${parseFloat(star.style.left) + x*PIXEL}px`)
          sat.style.setProperty("top", `${parseFloat(star.style.top) + y*PIXEL}px`)
          
          document.getElementById("infobox").innerText = `
          Bienvenue sur mon tableau de bord, voici mon satéllite imaginaire.


          Vitesse de la périphélie: ${v_periphelie.toFixed(3)} m/s
          Distance de la périphélie par rapport à la planète: ${(d_periphelie / 1000).toFixed(3)} km
          
          Vitesse de l'aphélie: ${v_aphelie.toFixed(3)} m/s
          Distance de l'aphélie par rapport à la planête: ${(d_aphelie / 1000).toFixed(3)} km


          Coordonnées du satéllite: (${x.toFixed(3)},${y.toFixed(3)}) en mètre 
          Vitesse angulaire du satéllite: ${(mouvement_moyen * 3600).toFixed(3)} km/h
          Masse du satéllite: ${SAT_MASSE}kg
          
          Excentricité: ${e.toFixed(5)}
          
          Echelle: 1m = ${PIXEL}Pixels
          Temps: ${new Date().getHours()}:${new Date().getMinutes()}:${(time%60).toFixed(0)} (d'après le timestamp)` ; 

          if(time > T) time = 0
        }

       setInterval(timeLoop, 60);





       window.addEventListener("resize", () => {
              // positions initiales
          star.style.top = (window.innerHeight/2)-(120/2)+"px"; star.style.left = (window.innerWidth/2)-(120/2)+"px";
          sat.style.top = (window.innerHeight/2)-(200/2)+"px"; sat.style.left = (window.innerWidth/2)-(50/2)+"px";
       });

      </script>
  </body>
</html>
